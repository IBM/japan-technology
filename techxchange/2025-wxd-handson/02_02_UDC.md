# 2. 非構造化データのキューレーション（Unstructured data curation：UDC）

UDCを実行する前に、処理対象の請求書(Invoice)を確認します。<br>

「**資産**」タブを選択します。左側のデータメニューにある「**データ資産**」をクリックして、一番上の「TR-INV_XXX_X_X.pdf」をクリックすると、内容が表示されます。<br>
<img width="800" alt="" src="images/02_02_1201add1.jpg"><br> 
&nbsp;<br>
<img width="800" alt="" src="images/02_02_1201add2.jpg"><br> 

確認できたら、右のプロジェクト名「**TechXchange Hands-on**」をクリックして、戻ります。<br> 
<img width="800" alt="" src="images/02_02_add3.jpg"><br> 


### 2-1 非構造化データキュレーション資産を作成する
1.「**新規資産**」を選択します。<br>
<img width="800" alt="" src="images/02_02_UDC01.jpg"><br>

2.下にスクロールし、「**Analyze and enrich unstructured data**」を選択します。<br>
<img width="800" alt="" src="images/02_02_UDC02.jpg"><br>

3.名前を入力します。先頭は必ずアルファベットで作成してください。例「TechXchange_UDC」<br>
名前を入力したら、保存をクリックします。<br>
<img width="800" alt="" src="images/02_02_UDC03.jpg"><br>

4.ガイド画面が表示された場合は、スキップをクリックします。<br>
<img width="800" alt="" src="images/02_02_UDC04.jpg"><br>

5.操作画面に入ります。真ん中の「**ドキュメントの追加**」をクリックし、「**プロジェクトから**」を選択します。<br>
<img width="800" alt="" src="images/02_02_UDC05.jpg"><br>

6.プロジェクト資産のインポート画面で、データ資産にある請求書(invoice)のPDFファイル5つにチェックを入れ、「**選択**」をクリックします。<br>
<img width="800" alt="" src="images/02_02_UDC06.jpg"><br>

7.資産が追加されたら、右側の「**分析の構成**」をクリックし、構成を見てみましょう。<br>
<img width="800" alt="" src="images/02_02_UDC07.jpg"><br>
[分析の構成]では、ドキュメント・サイズ、文書クラスなどの設定ができます。<br>
<img width="800" alt="" src="images/02_02_udc4.jpg"><br>

文書クラスの範囲の右側の「**選択**」をクリックします。サポートするドキュメントクラスを確認できます。
<img width="800" alt="" src="images/02_02_udc3.jpg"><br>
&nbsp;<br>
範囲外の文書を使用する場合は、右上の「**文書クラスのインポート**」からカスタマイズできます。今回はこの操作を行わないため、キャンセルをクリックします。<br>
<img width="800" alt="" src="images/02_02_udc5.jpg"><br>
&nbsp;<br>
<img width="300" alt="" src="images/02_02_udc6.jpg"><br>
&nbsp;<br>
今回は[分析の構成]をデフォルトのままにし、キャンセルをクリックします。
&nbsp;<br>
<img width="800" alt="" src="images/02_02_udc8.jpg"><br>


先ほどの画面に戻ったら、「**文書の分析**」をクリックします。
<img width="800" alt="" src="images/02_02_udc9.jpg"><br>

8.文書分析が始まります。処理には約2分かかります。<br>
この間に分析フローを確認しましょう。右上の「**分析待ち**」または「**分析開始**」または「**分析**」（処理経過によって変わります）をクリックします。<br>
「**再分析**」が表示された場合は、ここからフローのチェックができませんので、クリックしないようにしてください。<br>
<img width="800" alt="" src="images/02_02_1201add3.jpg"><br> 
&nbsp;<br>
新しいタブが開き、分析フローが表示されます。<br>
<img width="800" alt="" src="images/02_02_udcadd10.jpg"><br>
<br>
- Data assets：Ingestデータノードを使用して、使用するデータを指定します。<br>
- Classfication：指定するデータを分類します。<br>
- Extract：ソース・ドキュメントからコンテンツを抽出します。<br>
- Language Annotation：ドキュメントの言語を検出します。<br>
- Deasign flow output：次にのプロセスで処理するフローを出力します。<br>

&nbsp;<br>
右下にログウィンドウが表示され、ログを確認できます。<br>
<img width="800" alt="" src="images/02_02_udcadd11.jpg"><br>
&nbsp;<br>

9.全ノードが完了しましたら、このタブの×クリックして、タブを閉じます。先の画面で処理結果を確認できます。<br>
<img width="800" alt="" src="images/02_02_UDC09.jpg"><br>
&nbsp;<br>
ドキュメント・クラスがInvoice、言語がen(英語)だと分析されました。<br>

10.次に、右の「**プロセス文書**」をクリックします。<br>
この手順は、先ほどの「文書の分析」の最後にエクスポートされたフローを実行する処理です。<br>
<img width="800" alt="" src="images/02_02_UDC10.jpg"><br>
&nbsp;<br>
11.プロセス文書の設定画面が表示されます。<br>
<img width="800" alt="" src="images/02_02_UDC11.jpg"><br>
&nbsp;<br>
12.設定画面の下にスクロールし、出力設定を行います。<br>
まず、ベクター・データベース接続を設定します。この接続は、ベクトル化された結果を保存するために必要です。<br>
&nbsp;<br>
「**接続を選択してください**」をクリックします。<br>
<img width="800" alt="" src="images/02_02_UDC12.jpg"><br>
&nbsp;<br>
「**Milvus**」を選択し、下の青い「**選択**」ボタンをクリックします。<br>
<img width="800" alt="" src="images/02_02_UDC13.jpg"><br>

13.次に、抽出されたエンティティと値をIcebergテーブルに保存するため、エンティティ・データベース接続を設定します。<br>&nbsp;<br>
「**エンティティデータベース接続**」をクリックします。<br>
<img width="800" alt="" src="images/02_02_UDC14.jpg"><br>
&nbsp;<br>
接続設定画面で　「**starter**」「**iceberg_data**」「**invoice_schema**」を選択します。「**選択**」をクリックします。
<img width="800" alt="" src="images/02_02_UDC15.jpg"><br>

14.次に、下の「**ドキュメントライブラリ**」を設定します。ドキュメントライブラリは、プロジェクト内で出力された文書セットを保存する場所です。<br>&nbsp;<br>
右側の「**選択＋**」をクリックします。<br>
<img width="800" alt="" src="images/02_02_UDC22.jpg"><br>

事前に用意された「**invoice-document-library**」をクリックし、「**選択**」をクリックします。<br>
<img width="800" alt="" src="images/02_02_UDC23.jpg"><br>

16.設定が完了しました。下の青いボタン「**プロセス文書**」をクリックします。処理フローが開始されます。<br>

<img width="800" alt="" src="images/02_02_UDC24.jpg"><br>
&nbsp;<br>
設定の保存はしないため、「**このランのみに使用**」をクリックします。<br>
<img width="800" alt="" src="images/02_02_UDC25.jpg"><br>

17.処理が開始されます。処理時間は大体3分です。この間にフローを確認しましょう。右上の「**加工開始**」または「**分析まち**」または「**処理中**」（処理経過によって変わります）をクリックします。<br>

<img width="800" alt="" src="images/02_02_UDC26.jpg"><br>
&nbsp;<br>
<img width="800" alt="" src="images/02_02_UDC27.jpg"><br>
- Data assets：Ingestデータノードを使用して、使用するデータを指定します。<br>
- Classfication：指定するデータを分類します。<br>
- Annotation filter：自動で追加されたアノテーションに基づいてドキュメントをフィルタリングし、処理を効率化します。
- Extract：ソース・ドキュメントからコンテンツを抽出します。<br>
- Language Annotation：ドキュメントの言語を検出します。<br>
- Entity curation：抽出されたエンティティーを、ターゲット・テーブルのスキーマと互換性のある構造化形式に整理します。<br>
- Entity store：抽出されたエンティティーを保存します。<br>
- Chunking：文書を小さな意味単位に分けます。<br>
- Embedding：チャンキングされた内容を数値ベクトル化します。<br>
- watsonx.data Milvus：Milvusに出力します。<br>
- Document set：文書セットを出力、ドキュメントライブラリに追加します。<br>

18.右上の展開ボタンをクリックすると、ログの詳細が見えます。<br>
11個のノード全部完了したら、左側の「**戻る**」をクリックします。<br>
<img width="800" alt="" src="images/02_02_UDC28.jpg"><br>

ジョブの詳細画面に戻ります。上の「**TechXchange Hands-on**」をクリックし、プロジェクトに戻ります。<br>
<img width="800" alt="" src="images/02_02_UDC29.jpg"><br>



### 2-2 作成した資産を確認する
1.「**資産**」タブを選択し、左側のデータの下にある「**ドキュメント・セット**」を選択します。上記のプロセスで作成したドキュメント・セットが表示されますので、クリックします。<br>
<img width="800" alt="" src="images/02_02_UDC30.jpg"><br>

2.ドキュメント・セットの詳細画面に入ります。下にスクロールし、[出力]のところにある「**Invoice**」をクリックすると、出力された内容をプレビューできます。<br>
読み込まれた請求書(Invoice)から抽出されたエンティティとその値がテーブルに入っています。
<img width="800" alt="" src="images/02_02_UDC31.jpg"><br>
&nbsp;<br>
<img width="800" alt="" src="images/02_02_UDC32.jpg"><br>

3.ブラウザーの戻るボタンをクリックして、先ほどのドキュメント・セットの詳細画面に戻ります。<br>
下にスクロールし、[出力]のところにある「**Inovice_line_items**」をクリックします。<br>
<img width="800" alt="" src="images/02_02_add1.jpg"><br>
&nbsp;<br>
各請求書(Invoice)の明細がこのテーブルに格納されています。
<img width="800" alt="" src="images/02_02_add2.jpg"><br>
&nbsp;<br>
4.上の「**TechXchange Hands-on**」をクリックし、プロジェクトに戻ります。<br>
<img width="800" alt="" src="images/02_02_UDC33.jpg"><br>

次に、取り込んだドキュメントセットとチャットを実行します。
- [ドキュメントライブラリを使用してテストする](02_03_chat.md)
