## granite-8b-japanese 言語モデルを使い、フリー・フォームのプロンプトを改良しながら、地方の魅力を伝えるための文章を生成する

最終更新日: 2025/4/16

IBM watsonx.aiのプロンプト・ラボ (Prompt Lab)を使い、静岡県の魅力を伝えるための文章を作ってみましょう。
プロンプト内に何もヒントがない状態で文章を生成するところから出発し、新しい文脈（ヒント）を与えることで、プロンプトを実行した結果が変わっていくことを確認します。

途中、プロンプト・ラボの画面に入力するための文字列は、コピーしやすいように準備してあります。コピーした文字列を貼り付ける際には、PC/macのショートカット・キー操作を活用しましょう。
* Windowsの場合: [Ctrl]+[v]
* macOSの場合: [command]+[v]

参考URL: [プロンプト・ラボ](https://dataplatform.cloud.ibm.com/docs/content/wsj/analyze-data/fm-prompt-lab.html?context=wx&locale=ja "Prompt Lab")

免責事項: 
* 言語モデルによる間違った生成結果にご注意ください
  生成AIは事前学習したデータを活用しながらテキストを生成します。言語モデルに含まれている言葉が確率で選択されるため、生成AIは事実と異なる結果を生成する場合（ハルシネーション）があります。このハンズオンでは、段階的にプロンプトを改善するため、途中、意図しない結果を敢えて得ることも行います。生成AIのハルシネーションから第三者に間違った内容が伝わらないよう、言語モデルで生成された内容をそのまま利用するのではなく、必ず、事実確認を行なってください。
* 文脈に与えている内容は、インターネットから検索して確認できる情報で、このコンテンツの著者や著者が所属している企業と一切関係がありません。

前提条件:
* IBM watsonx 上に新規プロジェクトを作ってあること。直前にプロンプト・ラボを利用したチャットを体験をしていれば、同じプロジェクトを使ってください。 ([作成方法](https://github.com/IBM/japan-technology/tree/main/watsonx.ai/dojo/create-new-project "Create New Project"))

<img width="1524" alt="wxai03-00-newProject" src="https://github.com/user-attachments/assets/3a3a0179-c655-4c57-bc22-b90e15a7da5c">

プロジェクト作成後は、Watson Machine Learningの関連付けを確認してください。すでにプロジェクトを作っている場合は、この関連付けは不要です。
<img width="1524" alt="wxai03-00-associatedML" src="https://github.com/user-attachments/assets/5b3248b6-9683-454b-9ed6-99e439928eff">

##

1. 作成したプロジェクトの[概要]タブを開きます。
<img width="1524" alt="wxai03-01-newproject" src="https://github.com/user-attachments/assets/1f96241e-5b48-4bae-9db2-3069d2ddff5e">

2. 作業の開始欄にある[ファウンデーション・モデルを使用したチャットとプロンプトの作成]をクリックします。
<img width="1524" alt="wxai03-01-02-promptLab" src="https://github.com/user-attachments/assets/bbd2d8fe-07df-4255-8179-24344b98bd95">

3. Prompt Labの[フリー・フォーム]をクリックします。

* 3-1: [モデル: granite-3-8b-instruct]と表示されている右にある[v]をクリックして、[すべての基盤モデルを表示する]をクリックします。

<img width="294" alt="wxai03-01-choose-model" src="https://github.com/user-attachments/assets/3a09c8aa-0d11-44e9-8520-9b05e04f639c" />

* 3-2: 基盤モデルの選択画面の中から[granite-8b-japanese]のタイルを見つけて、クリックします。

<img width="1139" alt="wxai03-01-list-models" src="https://github.com/user-attachments/assets/a4e7debc-3b34-4969-8ae6-98d2ba051118" />

* 3-3: granite-8b-japanese のモデル・データシートが表示されたことを確認し、右下にある[モデルの選択]と書かれた青いボタンをクリックします。

<img width="1164" alt="wxai03-01-granite-model-datasheet" src="https://github.com/user-attachments/assets/02717374-bafb-469c-a1de-a2386f098633" />

* 3-4: フリー・フォームの作業用に[granite-8b-japanese]が選択されたことを確認します。
<img width="1521" alt="wxai03-01-03-Freeform" src="https://github.com/user-attachments/assets/86562be9-7e2e-4363-825a-4b5a51d6e078">

* 注意: 言語モデルの進化に伴い、granite-8b-japaneseは、2025/8/20に削除されます。2025/8/19までは、問題ありません。(近い将来、この演習内容をアップデートします）

<img width="258" alt="wxai03-01-granite-warning" src="https://github.com/user-attachments/assets/091ebcee-bb29-4174-990b-a41b977ba1d0" />


4. プロンプト・テキストとして、次の文字列をコピーして、貼り付けます。
```
静岡県を知らない人に、有名なアーティスト、 アニメの話、美味しい食事、名所、生産品などを含めて、楽しく静岡の魅力を伝えてください。
```

<img width="1524" alt="wxai03-01-04-simple-prompt" src="https://github.com/user-attachments/assets/bdf5cbaa-fc6d-41ed-82d9-0021bda04534">

5. 画面右下にある[生成]をクリックします。しばらく待つと生成結果が表示されます。
<img width="1524" alt="wxai03-01-05-unexpected-result" src="https://github.com/user-attachments/assets/8eaff4b9-86f4-4f7a-bd57-a5a98171b0ce">

6. 意味不明な結果を見て、ここで諦めないでください。ここから、順番に改善していきます。[出力のクリア]をクリックして、生成した内容を消去しましょう。先ほど生成された文字列が消えたことを確認します。
<img width="1521" alt="wxai03-01-06-clearOutput" src="https://github.com/user-attachments/assets/8f979ac3-1b2c-49cb-8c2b-f5ffa6daced3">

7. プロンプト・テキストをすべて消去し、新しいプロンプト・テキストを貼り付けます。
```
以下は、タスクを説明する指示と、文脈のある入力の組み合わせです。要求を適切に満たす応答を書きなさい。

### 指示:
与えられた質問に対して、文脈がある場合はそれも利用し、回答してください。

### 入力:

静岡県を知らない人に、有名なアーティスト、 アニメの話、美味しい食事、名所、生産品などを含めて、楽しく静岡の魅力を伝えてください。

### 応答:

```
<img width="1521" alt="wxai03-01-07-structuredPrompt" src="https://github.com/user-attachments/assets/06b56067-de8c-42e5-afc4-1c1a09e948f8">

8. 画面右下にある[生成]をクリックします。

<img width="1521" alt="wxai03-01-08-newResult" src="https://github.com/user-attachments/assets/62f93932-241d-4209-b99c-4afc2ff819ca">

9. 画面の右上側にあるモデル・パラメータ <img width="54" alt="wxai03-01-09-modelParameters" src="https://github.com/user-attachments/assets/ac1843cb-9473-4f17-9b4d-fae32a3e0ae7">
をクリックして、開きます。

<img width="1521" alt="wxai03-01-10-openedParmeters" src="https://github.com/user-attachments/assets/2cb2d4f6-ef8b-46a4-80a8-5841edf30083">

10. [出力のクリア]をクリックして、プロンプト・テキストを上記手順7の内容に戻します。モデル・パラメータの小さなウィンドウ内にある最小トークン数を「200」、最大トークン数を「1000」に変更します。
<img width="1521" alt="wxai03-01-11-modifiedParameters" src="https://github.com/user-attachments/assets/c99c666b-6952-40f8-aa27-27400ec8e795">


11. 画面右下の[生成]をクリックして、結果を確認します。内容の妥当性は無視して、手順8より、もっと多くのテキストが生成されたことがわかります。
<img width="1521" alt="wxai03-01-12-resultWithMoreText" src="https://github.com/user-attachments/assets/c444313a-f9a1-49d5-9baa-1378a0700ad2">

* 出力内容は必ずしもスクリーンショットと同じものにならない場合がありますので、ご注意ください。

12. [出力のクリア]をクリックして、生成されたテキストを消去します。モデル・パラメータにある[反復ペナルティ]を「2」に変更して、画面右下の[生成]をクリックします。
<img width="1521" alt="wxai03-01-13-resultWithPenelty2" src="https://github.com/user-attachments/assets/d1dfd080-e817-4793-8b61-5c476a4e6605">

この時点で、まだ出力内容に不安が残りますが、手順11と文体が変わったことを確認します。

13. ここから、プロンプト・テキストの中に、テキストを生成する上でのヒントを文脈として追加します。プロンプト・テキストをすべて消去し、新しいプロンプト・テキストを貼り付けます。

```
以下は、タスクを説明する指示と、文脈のある入力の組み合わせです。要求を適切に満たす応答を書きなさい。

### 指示:
与えられた質問に対して、文脈がある場合はそれも利用し、回答してください。

文脈:
- 静岡県の人気のレストランは「さわやか」です。さわやかには、美味しいハンバーグがあります。
- 静岡市の名所は、「三保の松原」です。海岸から富士山が見えます。
- 静岡県は、令和3年にきはだ・マグロの水揚げで日本一でした。
- 静岡県の県庁所在地は、「静岡市」です。浜松市ではありません。
- 浜松市には世界で有名な企業が複数あります。スズキ、ヤマハ、カワイといった企業は世界で有名です。カワイのピアノは、YOSHIKIさんが使っていることで有名です。
- アニメ作品「ラブライブ！サンシャイン！！」の聖地は、静岡県沼津市が中心です。伊豆・三津シーパラダイスも有名です。
- アニメ作品「ちびまる子ちゃん」の話は、静岡県静岡市清水区（旧清水市）がモデルになっています。

### 入力:
静岡県を知らない人に、有名なアーティスト、 アニメの話、美味しい食事、名所、生産品などを含めて、楽しく静岡の魅力を伝えてください。

### 応答:

```

14. モデル・パラメータから[反復ペナルティ]を「1」に戻します。

<img width="1521" alt="wxai03-01-14-improvedPrompt" src="https://github.com/user-attachments/assets/1f43b33a-487d-41fb-b959-7f569af8d06a">

15. 画面右下の[生成]をクリックします。

<img width="1521" alt="wxai03-01-15-improvedOutput" src="https://github.com/user-attachments/assets/f4adf608-eb35-4742-af16-73311c7d6088">

16. プロンプトを改良して、言語モデルに含まれていない知識を使わないようにします。プロンプト・テキストをすべて消去し、次の内容に置き換えてください。手順13との違いは、指示の中に「知識にないことは答えないでください」という1文があること、入力のところにある文章を生成してほしい背景や意図を含めるようにしたことです。
```
以下は、タスクを説明する指示と、文脈のある入力の組み合わせです。要求を適切に満たす応答を書きなさい。

### 指示:
与えられた質問に対して、文脈がある場合はそれも利用し、回答してください。知識にないことは答えないでください。

文脈:
- 静岡県には日本一の高さを誇る富士山があります。3,776メートルの高さで、世界中から登山者が集まります。
- 静岡県の人気のレストランは「さわやか」です。さわやかには、美味しいハンバーグがあります。
- 静岡市の名所は、「三保の松原」です。海岸から富士山が見えます。
- 静岡県は、令和3年にきはだ・マグロの水揚げで日本一でした。
- 静岡県の県庁所在地は、「静岡市」です。浜松市ではありません。
- 浜松市には世界で有名な企業が複数あります。スズキ、ヤマハ、カワイといった企業は世界で有名です。カワイのピアノは、YOSHIKIさんが使っていることで有名です。
- アニメ作品「ラブライブ！サンシャイン！！」の聖地は、静岡県沼津市が中心です。「ラブライブ！サンシャイン！！」の聖地として伊豆・三津シーパラダイスも有名です。
- アニメ作品「ちびまる子ちゃん」の話は、静岡県静岡市清水区（旧清水市）がモデルになっています。
- 有名なアーティスト、久保田利伸さんは静岡県静岡市清水区（旧清水市）出身です。蒲原駅前にある老舗の食堂「蒲原館」のラーメンが好きだそうです。

### 入力:
静岡県を知らない人に、楽しく静岡の魅力を伝える文章を作ります。有名な楽器やアニメの話、有名なアーティスト、最後に富士山と食事の話など行くべき名所などを紹介して、静岡に旅行したくなる人を増やしたいです。


### 応答:

```
<img width="1521" alt="wxai03-01-16-improvedPrompt" src="https://github.com/user-attachments/assets/6e9c9986-64c0-4f04-9a0b-7c48007bcacb">

17. 画面右下の[生成]をクリックします。


<img width="1521" alt="wxai03-01-17-improvedOutput" src="https://github.com/user-attachments/assets/6ae31973-5014-41a7-9037-ebb6b76046cd">

生成例:
```
静岡は、雄大な富士山、美味しい食べ物、魅力的な文化を持つ、素晴らしい場所です。静岡県を知らない人に、楽しく静岡の魅力を伝える文章を作ってみました：

静岡は、日本一の高さを誇る富士山、静岡が誇る人気のレストランさわやか、そして海岸から富士山が見える静岡市の名所、三保の松原など、多くの観光名所を持つ県です。

また、静岡県はきはだ・マグロの水揚げ量で日本一で、スズキ、ヤマハ、カワイなど、世界に名だたる企業が複数あります。中でも、ピアノ製造で有名なカワイのピアノは、YOSHIKIさんが使っていることでも有名です。

さらに、静岡県は、アニメ作品「ラブライブ！サンシャイン！！」の聖地として、伊豆・三津シーパラダイスも有名です。また、アニメ作品「ちびまる子ちゃん」の話は、静岡県静岡市清水区（旧清水市）がモデルになっています。

そして、静岡県と言えば、忘れてはならないのが久保田利伸さんです。彼は、静岡県静岡市清水区（旧清水市）出身です。蒲原駅前にある老舗の食堂「蒲原館」のラーメンが好きだそうで、静岡に旅行した際には、ぜひ立ち寄ってみたいものです。

静岡は、美味しい食べ物、魅力的な文化、雄大な自然を持つ、素晴らしい場所です。静岡に旅行して、その素晴らしさを体験してみてください！
```

18. [名前を付けて保存]をクリックし、任意の名前をつけて、プロンプト・セッションを保存します。

19. (オプション課題) 手順16で指定しているプロンプトを、お好きな地域や町を題材に書き換えて、結果を生成します。

演習1はここまでです。

このハンズオンを自習されている方へ、続きは[演習2](https://github.com/IBM/japan-technology/blob/main/watsonx.ai/dojo/03/02-structured-prompt/readme.md "structured Form & Deployment") となります。
