## granite-3-8b-instruct 基盤モデルを使い、フリー・フォームのプロンプトを改良しながら、地方の魅力を伝えるための文章を生成する

* 最終更新日: 2025/9/12
* 変更点: granite-8b-japanese 基盤モデルは 2025/8/20 に削除されたため、この演習で使う基盤モデルをgranite-3-8b-instructに変更しました。

IBM watsonx.aiのプロンプト・ラボ (Prompt Lab)を使い、静岡県の魅力を伝えるための文章を作ってみましょう。
プロンプト内に何もヒントがない状態で文章を生成するところから出発し、新しい文脈（ヒント）を与えることで、プロンプトを実行した結果が変わっていくことを確認します。

途中、プロンプト・ラボの画面に入力するための文字列は、コピーしやすいように準備してあります。コピーした文字列を貼り付ける際には、PC/macのショートカット・キー操作を活用しましょう。
* Windowsの場合: [Ctrl]+[v]
* macOSの場合: [command]+[v]

参考URL: [プロンプト・ラボ](https://dataplatform.cloud.ibm.com/docs/content/wsj/analyze-data/fm-prompt-lab.html?context=wx&locale=ja "Prompt Lab")

免責事項: 
* 基盤モデルによる間違った生成結果にご注意ください
  生成AIは事前学習したデータを活用しながらテキストを生成します。基盤モデルに含まれている言葉が確率で選択されるため、生成AIは事実と異なる結果を生成する場合（ハルシネーション）があります。このハンズオンでは、段階的にプロンプトを改善するため、途中、意図しない結果を敢えて得ることも行います。生成AIのハルシネーションから第三者に間違った内容が伝わらないよう、基盤モデルで生成された内容をそのまま利用するのではなく、必ず、事実確認を行なってください。
* 文脈に与えている内容は、インターネットから検索して確認できる情報で、このコンテンツの著者や著者が所属している企業と一切関係がありません。
* 生成AIは確率を用いて言葉を選ぶため、条件によって、生成結果に様々なバリエーションが生まれます。

前提条件:
* IBM watsonx 上に新規プロジェクトを作ってあること。直前にプロンプト・ラボを利用したチャットを体験をしていれば、同じプロジェクトを使ってください。 ([作成方法](https://github.com/IBM/japan-technology/tree/main/watsonx.ai/dojo/create-new-project "Create New Project"))

<img width="1005" height="922" alt="0301-01-NewProject" src="https://github.com/user-attachments/assets/5e87d406-d2a7-466c-a2fa-1a9b3ff97508" />


プロジェクト作成後は、Watson Machine Learningの関連付けを確認してください。すでにプロジェクトを作っている場合は、この関連付けは不要です。

<img width="1005" height="922" alt="0301-02-WMLAssociated" src="https://github.com/user-attachments/assets/d9a8c01e-a449-48b8-a65d-6ed668135854" />

##

1. 作成したプロジェクトの[概要]タブを開きます。

<img width="1005" height="922" alt="0301-03-ProjectOverview" src="https://github.com/user-attachments/assets/d897eacf-320e-492a-9989-7dce13489f89" />

2. 作業の開始欄にある[基盤モデルを使用したチャットとプロンプトの作成]をクリックします。

<img width="1005" height="922" alt="0301-04-NewPromptLab" src="https://github.com/user-attachments/assets/4e5dc855-4b4f-41a8-864c-40e018249d58" />

3. Prompt Labの[フリー・フォーム]をクリックします。

<img width="1005" height="922" alt="0301-05-FreeForm" src="https://github.com/user-attachments/assets/963c0804-3d48-40e4-8c72-1a561ca87d85" />

モデルの名前が [granite-3-8b-instruct] となっていることを確認します。
もしモデルの名前が異なっている場合は、3-1からの手順を実行してください。
* 3-1: [モデル: ]と表示されている右にある[v]をクリックして、[すべての基盤モデルを表示する]をクリックします。

<img width="226" height="146" alt="0301-06-ViewAllModel" src="https://github.com/user-attachments/assets/e869ae40-c588-4627-8964-79b23b5d89a0" />


* 3-2: 基盤モデルの選択画面の中から[granite-3-8b-instruct]のタイルを見つけて、クリックします。

<img width="1005" height="922" alt="0303-07-ChooseGranite3" src="https://github.com/user-attachments/assets/2b633785-d565-48c9-8c11-401ca700cc48" />


* 3-3: granite-3-8b-insturct のモデル・データシートが表示されたことを確認し、右下にある[モデルの選択]と書かれた青いボタンをクリックします。

<img width="1005" height="922" alt="0301-08-ChooseModel" src="https://github.com/user-attachments/assets/aedcb1f7-039e-4e3a-9792-643bd5ff5cbb" />


* 3-4: フリー・フォームの作業用に[granite-3-8b-instruct]が選択されたことを確認します。
  
<img width="1005" height="922" alt="0301-09-Granite3Ready" src="https://github.com/user-attachments/assets/8d9d9d20-4d0f-48ef-bcf2-2a432788562d" />


4. 画面右上にある [<img width="33" height="33" alt="0301-10-ModelParams" src="https://github.com/user-attachments/assets/3e61ec49-151f-4f5d-879d-b31bb4ba7ae7" />]をクリックし、プロンプト・テキストとして、次の文字列をコピーして、貼り付けます。
```
静岡県を知らない人に、有名なアーティスト、 アニメの話、美味しい食事、名所、生産品などを含めて、楽しく静岡の魅力を伝えてください。
```

<img width="1005" height="922" alt="0301-14-Prompt02" src="https://github.com/user-attachments/assets/fb60552d-ebaa-4a16-af0c-ed97789188b8" />


5. 画面右下にある[生成]をクリックします。しばらく待つと生成結果が表示されます。

<img width="1005" height="922" alt="0301-12-Result01" src="https://github.com/user-attachments/assets/7e2775a3-0100-4b37-94e8-8f9ba2108cf9" />

* ご注意: 無料体験版を利用している場合、「不明なエラーが発生しました。推論の生成中に何らかの問題が発生しました。」というメッセージが表示される場合があります。エラー表示を閉じてから、[生成]をクリックしてください。

6. 少ない入力から得られた結果なので、順番に改善していきましょう。[出力のクリア]をクリックして、生成した内容を消去しましょう。先ほど生成された文字列が消えたことを確認します。

<img width="1005" height="922" alt="0301-13-Clear01" src="https://github.com/user-attachments/assets/14489981-99d0-4c82-9a08-9d78c8fc839f" />


7. プロンプト・テキストをすべて消去し、新しいプロンプト・テキストを貼り付けます。
```
以下は、タスクを説明する指示と、文脈のある入力の組み合わせです。要求を適切に満たす応答を書きなさい。

### 指示:
与えられた質問に対して、文脈がある場合はそれも利用し、回答してください。

### 入力:

静岡県を知らない人に、有名なアーティスト、 アニメの話、美味しい食事、名所、生産品などを含めて、楽しく静岡の魅力を伝えてください。

### 応答:

```

<img width="1005" height="922" alt="0301-14-Prompt02" src="https://github.com/user-attachments/assets/4f79c6ce-24a5-4b19-b5fe-ae586cea0501" />


8. 画面右下にある[生成]をクリックします。

<img width="1005" height="922" alt="0301-15-Result02" src="https://github.com/user-attachments/assets/3be4439d-7931-407c-a88d-eb5c3beebaaf" />



9. [出力のクリア]をクリックして、プロンプト・テキストを上記手順7の内容に戻します。モデル・パラメータの小さなウィンドウ内にある最小トークン数を「200」、最大トークン数を「1000」に変更します。

<img width="1005" height="922" alt="0301-16-SetParams" src="https://github.com/user-attachments/assets/82a02f6b-65aa-4738-88ed-86455aa522e2" />


10. 画面右下の[生成]をクリックして、結果を確認します。内容の妥当性は無視して、手順8より、もっと多くのテキストが生成されたことがわかります。

<img width="1005" height="922" alt="0301-17-Prompt03" src="https://github.com/user-attachments/assets/225892da-2f13-4316-ad0e-e3e01d8c4748" />

* 出力内容は必ずしもスクリーンショットと同じものにならない場合がありますので、ご注意ください。

11. [出力のクリア]をクリックして、生成されたテキストを消去します。モデル・パラメータにある[反復ペナルティ]を```1.45```に変更して、画面右下の[生成]をクリックします。

<img width="1005" height="922" alt="0301-18-Param145" src="https://github.com/user-attachments/assets/2065498e-b51d-41ce-b991-0deb0f28b2fe" />

この時点で、まだ出力内容に不安が残りますが、手順10と文体が変わったことを確認します。

12. ここから、プロンプト・テキストの中に、テキストを生成する上でのヒントを文脈として追加します。プロンプト・テキストをすべて消去し、新しいプロンプト・テキストを貼り付けます。

```
以下は、タスクを説明する指示と、文脈のある入力の組み合わせです。要求を適切に満たす応答を書きなさい。

### 指示:
与えられた質問に対して、文脈がある場合はそれも利用し、回答してください。

文脈:
- 静岡県には日本一の高さを誇る富士山があります。3,776メートルの高さで、世界中から登山者が集まります。
- 静岡県の人気のレストランは「さわやか」です。さわやかには、美味しいハンバーグがあります。
- 静岡市の名所は、「三保の松原」です。海岸から富士山が見えます。
- 静岡県は、令和3年にきはだ・マグロの水揚げで日本一でした。
- 静岡県の県庁所在地は、「静岡市」です。浜松市ではありません。
- 浜松市には世界で有名な企業が複数あります。スズキ、ヤマハ、カワイといった企業は世界で有名です。カワイのピアノは、YOSHIKIさんが使っていることで有名です。
- アニメ作品「ラブライブ！サンシャイン！！」の聖地は、静岡県沼津市が中心です。伊豆・三津シーパラダイスも有名です。
- アニメ作品「ちびまる子ちゃん」の話は、静岡県静岡市清水区（旧清水市）がモデルになっています。

### 入力:
静岡県を知らない人に、有名なアーティスト、 アニメの話、美味しい食事、名所、生産品などを含めて、楽しく静岡の魅力を伝えてください。

### 応答:

```

13. モデル・パラメータから[反復ペナルティ]を「1」に戻します。

<img width="1005" height="922" alt="0301-19-Prompt03" src="https://github.com/user-attachments/assets/39783ac7-d871-4f00-a85c-b7cc4c04eef4" />


14. 画面右下の[生成]をクリックします。

<img width="1005" height="922" alt="0301-20-Result03" src="https://github.com/user-attachments/assets/6f141da3-1ed8-44d8-a738-c967c8ed5432" />


15. プロンプトを改良して、基盤モデルに含まれていない知識を使わないようにします。プロンプト・テキストをすべて消去し、次の内容に置き換えてください。手順12との違いは、指示の中に「知識にないことは答えないでください」という1文があること、入力のところにある文章を生成してほしい背景や意図を含めるようにしたことです。
```
以下は、タスクを説明する指示と、文脈のある入力の組み合わせです。要求を適切に満たす応答を書きなさい。

### 指示:
与えられた質問に対して、文脈がある場合はそれも利用し、回答してください。知識にないことは答えないでください。

文脈:
- 静岡県には日本一の高さを誇る富士山があります。3,776メートルの高さで、世界中から登山者が集まります。
- 静岡県の人気のレストランは「さわやか」です。さわやかには、美味しいハンバーグがあります。
- 静岡市の名所は、「三保の松原」です。海岸から富士山が見えます。
- 静岡県は、令和3年にきはだ・マグロの水揚げで日本一でした。
- 静岡県の県庁所在地は、「静岡市」です。浜松市ではありません。
- 浜松市には世界で有名な企業が複数あります。スズキ、ヤマハ、カワイといった企業は世界で有名です。カワイのピアノは、YOSHIKIさんが使っていることで有名です。
- アニメ作品「ラブライブ！サンシャイン！！」の聖地は、静岡県沼津市が中心です。「ラブライブ！サンシャイン！！」の聖地として伊豆・三津シーパラダイスも有名です。
- アニメ作品「ちびまる子ちゃん」の話は、静岡県静岡市清水区（旧清水市）がモデルになっています。
- 有名なアーティスト、久保田利伸さんは静岡県静岡市清水区（旧清水市）出身です。蒲原駅前にある老舗の食堂「蒲原館」のラーメンが好きだそうです。

### 入力:
静岡県を知らない人に、楽しく静岡の魅力を伝える文章を作ります。有名な楽器やアニメの話、有名なアーティスト、最後に富士山と食事の話など行くべき名所などを紹介して、静岡に旅行したくなる人を増やしたいです。


### 応答:

```

<img width="1005" height="922" alt="0301-21-Prompt04" src="https://github.com/user-attachments/assets/a5b73a29-5f7c-4c70-8033-90d204cf41af" />

16. 画面右下の[生成]をクリックします。


<img width="1521" alt="wxai03-01-17-improvedOutput" src="https://github.com/user-attachments/assets/6ae31973-5014-41a7-9037-ebb6b76046cd">

生成例:
```
静岡県は、日本の美しい景色と豊かな文化を体験できる絶好の場所です。富士山、日本一の高さを誇る山で、世界中から登山者が集まります。この美しい山を見上げながら、美味しいハンバーグを楽しむことができるのは、静岡県の人気レストラン「さわやか」です。

静岡市の名所である「三保の松原」は、海岸から富士山を一望できる場所で、素晴らしい写真を撮るのに最適です。静岡県は、令和3年にきはだ・マグロの水揚げで日本一となり、美味しい魚介類を味わうことができます。

静岡県は、世界で有名な企業の本拠地となっています。スズキ、ヤマハ、カワイなどの企業は、静岡県の経済に大きな貢献をしています。カワイのピアノは、YOSHIKIさんが使っていることで有名で、静岡県の音楽文化に大きな影響を与えています。

アニメファンには、「ラブライブ！サンシャイン！！」の聖地である沼津市を訪れることをお勧めします。伊豆・三津シーパラダイスも、このアニメのファンにとっては必見の場所です。「ちびまる子ちゃん」の話は、静岡県静岡市清水区（旧清水市）をモデルにしており、この地域を訪れることで、アニメの世界に足を踏み入れることができます。

有名なアーティスト、久保田利伸さんは、静岡県静岡市清水区（旧清水市）出身です。蒲原駅前にある老舗の食堂「蒲原館」のラーメンが好きだそうです。静岡県のラーメンは、独特の味わいと歴史を持っています。

最後に、静岡県の富士山を見上げながら、美味しい食事を楽しむことができるのは、静岡県の名所である「三保の松原」です。この場所は、静岡県の美しい景色と豊かな文化を体験できる絶好の場所です。静岡県を訪れることで、日本の美しい景色と豊かな文化を体験することができるでしょう。静岡県を訪れることをお勧めします。
```

17. [名前を付けて保存]をクリックし、任意の名前をつけて、プロンプト・セッションを保存します。

18. (オプション課題) 手順15で指定しているプロンプトを、お好きな地域や町を題材に書き換えて、結果を生成します。

演習1はここまでです。基盤モデルに含まれていない情報を「ヒント」としてプロンプトに加えることで、生成AIが出力する内容が変わったことを体験しました。このヒントを与える方法として、Webやデータベースの検索結果を用いているものをRAG(Retrieval Augmented Generation、拡張検索生成)と呼んでいます。

* SkillsBuildのセミナーに参加されている方は、[AIエージェントを試してみる](https://github.com/IBM/japan-technology/blob/main/watsonx.ai/dojo/07/readme.md)、へ進んでください。

このハンズオンを自習されている方へ、続きは[演習2](https://github.com/IBM/japan-technology/blob/main/watsonx.ai/dojo/03/02-structured-prompt/readme.md "structured Form & Deployment") となります。
